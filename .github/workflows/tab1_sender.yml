name: demo
on: 
  push:
  pull_request:
  release:
jobs:
  reciever:
    name: run on reciever 
    runs-on: self-hosted
    steps:
        # Runs a set of commands using the runners shell
        - name: Create Build Environment 2
          run: |
            echo Install build tools
            sudo modprobe virtio-lo
            sudo modprobe virtio_gpu
            lsmod | grep virtio
            ls -la
            rvgpu-renderer -b 1280x720@0,0 -p 55667
        
  sender:    
    name: run on senderer
    runs-on: self-hosted-2
    steps:
      # Runs a set of commands using the runners shell
      - name: Create Build Environment
        run: |
          echo Sender run
          ls -la
          
          sudo rm -rf /run/user/0
          sudo mkdir -p /run/user/0
          sudo export XDG_RUNTIME_DIR=/run/user/0
          sudo rvgpu-proxy -l 0 -s 1280x720@0,0 -n 127.0.0.1 &
          sudo export LD_LIBRARY_PATH=/usr/lib/mesa-virtio
          sudo weston --backend drm-backend.so --tty=2 --seat=seat_virtual -i 0 --log=/tmp/weston.log &
          sudo glmark2-es2-wayland

          
          
